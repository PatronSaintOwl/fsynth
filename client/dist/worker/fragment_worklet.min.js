class FragmentWorkletProcessor extends AudioWorkletProcessor{constructor(){super(),this.oscillators=[],this.note_buffer=[],this.next_note_buffer=[],this.wavetable=[],this.note_time_samples=0,this.lerp_t_step=0,this.lerp_t=0,this.curr_sample=0,this.wavetable_size=0,this.wavetable_size_m1=0,this.play=!1,this.port.onmessage=(t=>{var e=t.data;0===e.type?(this.oscillators=e.oscillators,this.note_time_samples=e.nts,this.lerp_t_step=e.lts,this.wavetable=function(t){var e=new Float32Array(t),s=0,i=2*Math.PI/t,r=0;for(r=0;r<t;r+=1)e[r]=Math.sin(s),s+=i;return e}(e.wsize),this.wavetable_size=e.wsize,this.wavetable_size_m1=e.wsize-1):1===e.type?this.play=!1:2===e.type?this.play=!0:this.next_note_buffer=new Float32Array(e.d)})}process(t,e,s){let i=e[0],r=i[0],a=i[0];if(i.length>1&&(a=i[1]),!this.play||0===this.oscillators.length){for(let t=0;t<r.length;++t)r[t]=0,a[t]=0;return!0}let l=null,h=0,o=0,_=0,n=this.note_buffer,p=this.lerp_t_step,f=this.lerp_t,u=(this.wavetable_size,this.wavetable_size_m1),m=this.curr_sample;for(let t=0;t<r.length;++t){h=0,o=0;for(let t=0;t<n.length;t+=5){var b=n[t],c=n[t+1],w=n[t+2],v=n[t+3],g=n[t+4];l=this.oscillators[b],h+=(c+v*f)*(_=this.wavetable[l.phase_index&u]),o+=(w+g*f)*_,l.phase_index+=l.phase_step,l.phase_index&=u}r[t]=h,a[t]=o,f+=1*p,f=Math.min(f,1),(m+=1)>=this.note_time_samples&&(p=0,m=0,this.note_buffer!==this.next_note_buffer&&(f=0,p=1/this.note_time_samples,this.note_buffer=this.next_note_buffer,n=this.note_buffer,this.port.postMessage({done:!0})))}return this.lerp_t=f,this.curr_sample=m,!0}}registerProcessor("fragment-worklet-processor",FragmentWorkletProcessor);