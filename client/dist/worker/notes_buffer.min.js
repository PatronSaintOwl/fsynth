self.onmessage=function(a){"use strict";var t,e,r,d,n,o,f,s,l,i,p,u=a.data.score_height,w=new Float32Array(5*u),y=0,A=0,c=u-1,g=0,m=0,h=1;for(a.data.float?(t=new Float32Array(a.data.prev_data),e=new Float32Array(a.data.data),f=1):(t=new Uint8ClampedArray(a.data.prev_data),e=new Uint8ClampedArray(a.data.data),f=1/255),s=e.length,a.data.mono&&(m=3,h=3),l=0;l<s;l+=4){if(r=t[l+m],d=t[l+h],n=e[l+m],o=e[l+h],n>0||o>0)i=n*f,p=o*f,y=r*f,A=d*f,w[g]=c,w[g+1]=y,w[g+2]=A,w[g+3]=i-y,w[g+4]=p-A;else{if(!(r>0||d>0)){c-=1;continue}y=r*f,A=d*f,w[g]=c,w[g+1]=y,w[g+2]=A,w[g+3]=-y,w[g+4]=-A}c-=1,g+=5}postMessage({d:w.buffer},[w.buffer])};