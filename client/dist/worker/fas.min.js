var _fas=!1,_fas_timeout,_fas_ws,_FAS_ENABLE=0,_FAS_DISABLE=1,_FAS_AUDIO_INFOS=2,_FAS_GAIN_INFOS=3,_FAS_FRAME=4,_getAudioInfosBuffer=function(e){if(!(e.h<=0||e.octaves<=0||e.base_freq<=0)){var n=new ArrayBuffer(32),s=new Uint8Array(n,0,1),t=new Uint32Array(n,8,3),a=new Float64Array(n,24);return s[0]=0,t[0]=e.h,t[1]=e.octaves,t[2]=e.float_data===!0?1:0,a[0]=e.base_freq,n}},_getGainBuffer=function(e){var n=new ArrayBuffer(16),s=new Uint8Array(n,0,1),t=new Float64Array(n,8);return s[0]=2,t[0]=e.gain,n},_sendAudioInfos=function(e){if(_fas){if(1!==_fas_ws.readyState)return void setTimeout(_sendAudioInfos,1e3,e);try{_fas_ws.send(_getAudioInfosBuffer(e))}finally{}}},_sendGain=function(e){if(_fas){if(1!==_fas_ws.readyState)return void setTimeout(_sendGain,1e3,e);try{_fas_ws.send(_getGainBuffer(e))}finally{}}},_sendFrame=function(e,n,s,t){if(1===_fas_ws.readyState){var a,_,r,f,o,i;if(s?(a=new Float32Array(e[0]),o=24+4*a.length*e.length):(a=new Uint8Array(e[0]),o=24+a.length*e.length),_=new ArrayBuffer(o),r=new Uint8Array(_,0,1),f=new Uint32Array(_,8,3),i=0,r[0]=1,f[0]=e.length,f[1]=n===!0?1:0,f[2]=t,s)for(i=0;i<e.length;i+=1)r=new Float32Array(_,24+4*a.length*i,a.length),r.set(new Float32Array(e[i]));else for(i=0;i<e.length;i+=1)r=new Uint8Array(_,24+a.length*i,a.length),r.set(new Uint8Array(e[i]));try{_fas_ws.send(_)}finally{}}},_disconnect=function(){_fas_ws&&_fas_ws.close(4e3),clearTimeout(_fas_timeout)},_connect=function(e){_fas_ws=new WebSocket("ws://"+e.address),_fas_ws.binaryType="arraybuffer",_fas_ws.onopen=function(){postMessage({status:"open"}),_sendAudioInfos(e.audio_infos),_sendGain(e.audio_infos)},_fas_ws.onerror=function(e){postMessage({status:"error"})},_fas_ws.onclose=function(n){_fas&&4e3!==n.code&&(postMessage({status:"close"}),clearTimeout(_fas_timeout),_fas_timeout=setTimeout(_connect,5e3,e))}};self.onmessage=function(e){"use strict";var n=e.data,s=n.cmd,t=n.arg;s===_FAS_ENABLE?(_fas=!0,_connect(t)):s===_FAS_DISABLE?(_fas=!1,_disconnect()):s===_FAS_AUDIO_INFOS?_sendAudioInfos(t):s===_FAS_GAIN_INFOS?_sendGain(t):s===_FAS_FRAME&&_sendFrame(t,n.mono,n.float,n.synthesis_type)};