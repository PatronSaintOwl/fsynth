var _fas=!1,_fas_timeout,_fas_ws,_FAS_ENABLE=0,_FAS_DISABLE=1,_FAS_AUDIO_INFOS=2,_FAS_GAIN_INFOS=3,_FAS_FRAME=4,_FAS_CHN_INFOS=5,_getAudioInfosBuffer=function(e){if(!(e.h<=0||e.octaves<=0||e.base_freq<=0)){var n=new ArrayBuffer(32),t=new Uint8Array(n,0,1),s=new Uint32Array(n,8,3),a=new Float64Array(n,24);return t[0]=0,s[0]=e.h,s[1]=e.octaves,s[2]=e.float_data===!0?1:0,a[0]=e.base_freq,n}},_getGainBuffer=function(e){var n=new ArrayBuffer(16),t=new Uint8Array(n,0,1),s=new Float64Array(n,8);return t[0]=2,s[0]=e.gain,n},_sendAudioInfos=function(e){if(_fas){if(1!==_fas_ws.readyState)return void setTimeout(_sendAudioInfos,1e3,e);try{_fas_ws.send(_getAudioInfosBuffer(e))}finally{}}},_sendGain=function(e){if(_fas){if(1!==_fas_ws.readyState)return void setTimeout(_sendGain,1e3,e);try{_fas_ws.send(_getGainBuffer(e))}finally{}}},_sendChnInfos=function(e){if(_fas){if(1!==_fas_ws.readyState)return void setTimeout(_sendChnInfos,1e3,e);var n=new ArrayBuffer(16+8*e.length),t=new Uint8Array(n,0,1),s=new Uint32Array(n,8,1),a=0;for(t[0]=3,s[0]=e.length,a=0;a<e.length;a+=1)t=new Uint32Array(n,16+8*a,2),t[0]=0,t[1]=0,e[a][0]&&(t[0]=e[a][0]),e[a][1]&&(t[1]=e[a][1]);try{_fas_ws.send(n)}finally{}}},_sendFrame=function(e,n,t){if(1===_fas_ws.readyState){var s,a,_,r,f,o;if(t?(s=new Float32Array(e[0]),f=16+4*s.length*e.length):(s=new Uint8Array(e[0]),f=16+s.length*e.length),a=new ArrayBuffer(f),_=new Uint8Array(a,0,1),r=new Uint32Array(a,8,2),o=0,_[0]=1,r[0]=e.length,r[1]=n===!0?1:0,t)for(o=0;o<e.length;o+=1)_=new Float32Array(a,16+4*s.length*o,s.length),_.set(new Float32Array(e[o]));else for(o=0;o<e.length;o+=1)_=new Uint8Array(a,16+s.length*o,s.length),_.set(new Uint8Array(e[o]));try{_fas_ws.send(a)}finally{}}},_disconnect=function(){_fas_ws&&_fas_ws.close(4e3),clearTimeout(_fas_timeout)},_connect=function(e){_fas_ws=new WebSocket("ws://"+e.address),_fas_ws.binaryType="arraybuffer",_fas_ws.onopen=function(){postMessage({status:"open"})},_fas_ws.onerror=function(e){postMessage({status:"error"})},_fas_ws.onclose=function(n){_fas&&4e3!==n.code&&(postMessage({status:"close"}),clearTimeout(_fas_timeout),_fas_timeout=setTimeout(_connect,5e3,e))}};self.onmessage=function(e){"use strict";var n=e.data,t=n.cmd,s=n.arg;t===_FAS_ENABLE?(_fas=!0,_connect(s)):t===_FAS_DISABLE?(_fas=!1,_disconnect()):t===_FAS_AUDIO_INFOS?_sendAudioInfos(s):t===_FAS_GAIN_INFOS?_sendGain(s):t===_FAS_FRAME?_sendFrame(s,n.mono,n.float):t===_FAS_CHN_INFOS&&_sendChnInfos(s)};