function setupTypedArray(t,e){"function"!=typeof this[t]&&"object"!=typeof this[t]&&("function"==typeof this[e]&&"object"!=typeof this[e]?this[t]=this[e]:this[t]=function(t){return t instanceof Array?t:"number"==typeof t?new Array(t):void 0})}function FourierTransform(t,e){this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*e/2,this.spectrum=new Float32Array(t/2),this.real=new Float32Array(t),this.imag=new Float32Array(t),this.peakBand=0,this.peak=0,this.getBandFrequency=function(t){return this.bandwidth*t+this.bandwidth/2},this.calculateSpectrum=function(){for(var e,r,a,s=this.spectrum,n=this.real,i=this.imag,o=2/this.bufferSize,h=Math.sqrt,u=0,l=t/2;u<l;u++)e=n[u],r=i[u],a=o*h(e*e+r*r),a>this.peak&&(this.peakBand=u,this.peak=a),s[u]=a}}function DFT(t,e){FourierTransform.call(this,t,e);var r=t/2*t,a=2*Math.PI;this.sinTable=new Float32Array(r),this.cosTable=new Float32Array(r);for(var s=0;s<r;s++)this.sinTable[s]=Math.sin(s*a/t),this.cosTable[s]=Math.cos(s*a/t)}function FFT(t,e){FourierTransform.call(this,t,e),this.reverseTable=new Uint32Array(t);for(var r,a=1,s=t>>1;a<t;){for(r=0;r<a;r++)this.reverseTable[r+a]=this.reverseTable[r]+s;a<<=1,s>>=1}for(this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),r=0;r<t;r++)this.sinTable[r]=Math.sin(-Math.PI/r),this.cosTable[r]=Math.cos(-Math.PI/r)}function RFFT(t,e){FourierTransform.call(this,t,e),this.trans=new Float32Array(t),this.reverseTable=new Uint32Array(t),this.reverseBinPermute=function(t,e){var r,a=this.bufferSize,s=a>>>1,n=a-1,i=1,o=0;t[0]=e[0];do{for(o+=s,t[i]=e[o],t[o]=e[i],i++,r=s<<1;r>>=1,!((o^=r)&r););o>=i&&(t[i]=e[o],t[o]=e[i],t[n-i]=e[n-o],t[n-o]=e[n-i]),i++}while(i<s);t[n]=e[n]},this.generateReverseTable=function(){var t,e=this.bufferSize,r=e>>>1,a=e-1,s=1,n=0;this.reverseTable[0]=0;do{for(n+=r,this.reverseTable[s]=n,this.reverseTable[n]=s,s++,t=r<<1;t>>=1,!((n^=t)&t););n>=s&&(this.reverseTable[s]=n,this.reverseTable[n]=s,this.reverseTable[a-s]=a-n,this.reverseTable[a-n]=a-s),s++}while(s<r);this.reverseTable[a]=a},this.generateReverseTable()}function Sampler(t,e,r,a,s,n,i,o){this.file=t,this.bufferSize=e,this.sampleRate=r,this.playStart=a||0,this.playEnd=s||1,this.loopStart=n||0,this.loopEnd=i||1,this.loopMode=o||DSP.OFF,this.loaded=!1,this.samples=[],this.signal=new Float32Array(e),this.frameCount=0,this.envelope=null,this.amplitude=1,this.rootFrequency=110,this.frequency=550,this.step=this.frequency/this.rootFrequency,this.duration=0,this.samplesProcessed=0,this.playhead=0;var h=document.createElement("AUDIO"),u=this;this.loadSamples=function(t){for(var e=DSP.getChannel(DSP.MIX,t.frameBuffer),r=0;r<e.length;r++)u.samples.push(e[r])},this.loadComplete=function(){u.samples=new Float32Array(u.samples),u.loaded=!0},this.loadMetaData=function(){u.duration=h.duration},h.addEventListener("MozAudioAvailable",this.loadSamples,!1),h.addEventListener("loadedmetadata",this.loadMetaData,!1),h.addEventListener("ended",this.loadComplete,!1),h.muted=!0,h.src=t,h.play()}function Oscillator(t,e,r,a,s){switch(this.frequency=e,this.amplitude=r,this.bufferSize=a,this.sampleRate=s,this.frameCount=0,this.waveTableLength=2048,this.cyclesPerSample=e/s,this.signal=new Float32Array(a),this.envelope=null,parseInt(t,10)){case DSP.TRIANGLE:this.func=Oscillator.Triangle;break;case DSP.SAW:this.func=Oscillator.Saw;break;case DSP.SQUARE:this.func=Oscillator.Square;break;default:case DSP.SINE:this.func=Oscillator.Sine}this.generateWaveTable=function(){Oscillator.waveTable[this.func]=new Float32Array(2048);for(var t=this.waveTableLength/this.sampleRate,e=1/t,r=0;r<this.waveTableLength;r++)Oscillator.waveTable[this.func][r]=this.func(r*e/this.sampleRate)},"undefined"==typeof Oscillator.waveTable&&(Oscillator.waveTable={}),"undefined"==typeof Oscillator.waveTable[this.func]&&this.generateWaveTable(),this.waveTable=Oscillator.waveTable[this.func]}function ADSR(t,e,r,a,s,n){this.sampleRate=n,this.attackLength=t,this.decayLength=e,this.sustainLevel=r,this.sustainLength=a,this.releaseLength=s,this.sampleRate=n,this.attackSamples=t*n,this.decaySamples=e*n,this.sustainSamples=a*n,this.releaseSamples=s*n,this.update=function(){this.attack=this.attackSamples,this.decay=this.attack+this.decaySamples,this.sustain=this.decay+this.sustainSamples,this.release=this.sustain+this.releaseSamples},this.update(),this.samplesProcessed=0}function IIRFilter(t,e,r,a){switch(this.sampleRate=a,t){case DSP.LOWPASS:case DSP.LP12:this.func=new IIRFilter.LP12(e,r,a)}}function IIRFilter2(t,e,r,a){this.type=t,this.cutoff=e,this.resonance=r,this.sampleRate=a,this.f=Float32Array(4),this.f[0]=0,this.f[1]=0,this.f[2]=0,this.f[3]=0,this.calcCoeff=function(t,e){this.freq=2*Math.sin(Math.PI*Math.min(.25,t/(2*this.sampleRate))),this.damp=Math.min(2*(1-Math.pow(e,.25)),Math.min(2,2/this.freq-.5*this.freq))},this.calcCoeff(e,r)}function WindowFunction(t,e){switch(this.alpha=e,t){case DSP.BARTLETT:this.func=WindowFunction.Bartlett;break;case DSP.BARTLETTHANN:this.func=WindowFunction.BartlettHann;break;case DSP.BLACKMAN:this.func=WindowFunction.Blackman,this.alpha=this.alpha||.16;break;case DSP.COSINE:this.func=WindowFunction.Cosine;break;case DSP.GAUSS:this.func=WindowFunction.Gauss,this.alpha=this.alpha||.25;break;case DSP.HAMMING:this.func=WindowFunction.Hamming;break;case DSP.HANN:this.func=WindowFunction.Hann;break;case DSP.LANCZOS:this.func=WindowFunction.Lanczoz;break;case DSP.RECTANGULAR:this.func=WindowFunction.Rectangular;break;case DSP.TRIANGULAR:this.func=WindowFunction.Triangular}}function sinh(t){return(Math.exp(t)-Math.exp(-t))/2}function Biquad(t,e){this.Fs=e,this.type=t,this.parameterType=DSP.Q,this.x_1_l=0,this.x_2_l=0,this.y_1_l=0,this.y_2_l=0,this.x_1_r=0,this.x_2_r=0,this.y_1_r=0,this.y_2_r=0,this.b0=1,this.a0=1,this.b1=0,this.a1=0,this.b2=0,this.a2=0,this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0,this.f0=3e3,this.dBgain=12,this.Q=1,this.BW=-3,this.S=1,this.coefficients=function(){var t=[this.b0,this.b1,this.b2],e=[this.a0,this.a1,this.a2];return{b:t,a:e}},this.setFilterType=function(t){this.type=t,this.recalculateCoefficients()},this.setSampleRate=function(t){this.Fs=t,this.recalculateCoefficients()},this.setQ=function(t){this.parameterType=DSP.Q,this.Q=Math.max(Math.min(t,115),.001),this.recalculateCoefficients()},this.setBW=function(t){this.parameterType=DSP.BW,this.BW=t,this.recalculateCoefficients()},this.setS=function(t){this.parameterType=DSP.S,this.S=Math.max(Math.min(t,5),1e-4),this.recalculateCoefficients()},this.setF0=function(t){this.f0=t,this.recalculateCoefficients()},this.setDbGain=function(t){this.dBgain=t,this.recalculateCoefficients()},this.recalculateCoefficients=function(){var e;e=t===DSP.PEAKING_EQ||t===DSP.LOW_SHELF||t===DSP.HIGH_SHELF?Math.pow(10,this.dBgain/40):Math.sqrt(Math.pow(10,this.dBgain/20));var r=DSP.TWO_PI*this.f0/this.Fs,a=Math.cos(r),s=Math.sin(r),n=0;switch(this.parameterType){case DSP.Q:n=s/(2*this.Q);break;case DSP.BW:n=s*sinh(Math.LN2/2*this.BW*r/s);break;case DSP.S:n=s/2*Math.sqrt((e+1/e)*(1/this.S-1)+2)}var i;switch(this.type){case DSP.LPF:this.b0=(1-a)/2,this.b1=1-a,this.b2=(1-a)/2,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.HPF:this.b0=(1+a)/2,this.b1=-(1+a),this.b2=(1+a)/2,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.BPF_CONSTANT_SKIRT:this.b0=s/2,this.b1=0,this.b2=-s/2,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.BPF_CONSTANT_PEAK:this.b0=n,this.b1=0,this.b2=-n,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.NOTCH:this.b0=1,this.b1=-2*a,this.b2=1,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.APF:this.b0=1-n,this.b1=-2*a,this.b2=1+n,this.a0=1+n,this.a1=-2*a,this.a2=1-n;break;case DSP.PEAKING_EQ:this.b0=1+n*e,this.b1=-2*a,this.b2=1-n*e,this.a0=1+n/e,this.a1=-2*a,this.a2=1-n/e;break;case DSP.LOW_SHELF:i=s*Math.sqrt((3^e)*(1/this.S-1)+2*e),this.b0=e*(e+1-(e-1)*a+i),this.b1=2*e*(e-1-(e+1)*a),this.b2=e*(e+1-(e-1)*a-i),this.a0=e+1+(e-1)*a+i,this.a1=-2*(e-1+(e+1)*a),this.a2=e+1+(e-1)*a-i;break;case DSP.HIGH_SHELF:i=s*Math.sqrt((3^e)*(1/this.S-1)+2*e),this.b0=e*(e+1+(e-1)*a+i),this.b1=-2*e*(e-1+(e+1)*a),this.b2=e*(e+1+(e-1)*a-i),this.a0=e+1-(e-1)*a+i,this.a1=2*(e-1-(e+1)*a),this.a2=e+1-(e-1)*a-i}this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0},this.process=function(t){for(var e=t.length,r=new Float32Array(e),a=0;a<t.length;a++)r[a]=this.b0a0*t[a]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=r[a],this.x_2_l=this.x_1_l,this.x_1_l=t[a];return r},this.processStereo=function(t){for(var e=t.length,r=new Float32Array(e),a=0;a<e/2;a++)r[2*a]=this.b0a0*t[2*a]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=r[2*a],this.x_2_l=this.x_1_l,this.x_1_l=t[2*a],r[2*a+1]=this.b0a0*t[2*a+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r,this.y_2_r=this.y_1_r,this.y_1_r=r[2*a+1],this.x_2_r=this.x_1_r,this.x_1_r=t[2*a+1];return r}}function GraphicalEq(t){this.FS=t,this.minFreq=40,this.maxFreq=16e3,this.bandsPerOctave=1,this.filters=[],this.freqzs=[],this.calculateFreqzs=!0,this.recalculateFilters=function(){var t=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var e=0;e<t;e++){var r=this.minFreq*Math.pow(2,e/this.bandsPerOctave),a=new Biquad(DSP.PEAKING_EQ,this.FS);a.setDbGain(0),a.setBW(1/this.bandsPerOctave),a.setF0(r),this.filters[e]=a,this.recalculateFreqz(e)}},this.setMinimumFrequency=function(t){this.minFreq=t,this.recalculateFilters()},this.setMaximumFrequency=function(t){this.maxFreq=t,this.recalculateFilters()},this.setBandsPerOctave=function(t){this.bandsPerOctave=t,this.recalculateFilters()},this.setBandGain=function(t,e){if(t<0||t>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds.";if(!e)throw"A gain must be passed.";this.filters[t].setDbGain(e),this.recalculateFreqz(t)},this.recalculateFreqz=function(t){if(this.calculateFreqzs){if(t<0||t>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds. "+t+" is out of [0, "+this.filters.length-1+"]";if(!this.w){this.w=Float32Array(400);for(var e=0;e<this.w.length;e++)this.w[e]=Math.PI/this.w.length*e}var r=[this.filters[t].b0,this.filters[t].b1,this.filters[t].b2],a=[this.filters[t].a0,this.filters[t].a1,this.filters[t].a2];this.freqzs[t]=DSP.mag2db(DSP.freqz(r,a,this.w))}},this.process=function(t){for(var e=t,r=0;r<this.filters.length;r++)e=this.filters[r].process(e);return e},this.processStereo=function(t){for(var e=t,r=0;r<this.filters.length;r++)e=this.filters[r].processStereo(e);return e}}function MultiDelay(t,e,r,a){this.delayBufferSamples=new Float32Array(t),this.delayInputPointer=e,this.delayOutputPointer=0,this.delayInSamples=e,this.masterVolume=r,this.delayVolume=a}function SingleDelay(t,e,r){this.delayBufferSamples=new Float32Array(t),this.delayInputPointer=e,this.delayOutputPointer=0,this.delayInSamples=e,this.delayVolume=r}function Reverb(t,e,r,a,s,n){this.delayInSamples=e,this.masterVolume=r,this.mixVolume=a,this.delayVolume=s,this.dampFrequency=n,this.NR_OF_MULTIDELAYS=6,this.NR_OF_SINGLEDELAYS=6,this.LOWPASSL=new IIRFilter2(DSP.LOWPASS,n,0,44100),this.LOWPASSR=new IIRFilter2(DSP.LOWPASS,n,0,44100),this.singleDelays=[];var i,o;for(i=0;i<this.NR_OF_SINGLEDELAYS;i++)o=1+i/7,this.singleDelays[i]=new SingleDelay(t,Math.round(this.delayInSamples*o),this.delayVolume);for(this.multiDelays=[],i=0;i<this.NR_OF_MULTIDELAYS;i++)o=1+i/10,this.multiDelays[i]=new MultiDelay(t,Math.round(this.delayInSamples*o),this.masterVolume,this.delayVolume)}var DSP={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};setupTypedArray("Float32Array","WebGLFloatArray"),setupTypedArray("Int32Array","WebGLIntArray"),setupTypedArray("Uint16Array","WebGLUnsignedShortArray"),setupTypedArray("Uint8Array","WebGLUnsignedByteArray"),DSP.invert=function(t){for(var e=0,r=t.length;e<r;e++)t[e]*=-1;return t},DSP.interleave=function(t,e){if(t.length!==e.length)throw"Can not interleave. Channel lengths differ.";for(var r=new Float32Array(2*t.length),a=0,s=t.length;a<s;a++)r[2*a]=t[a],r[2*a+1]=e[a];return r},DSP.deinterleave=function(){var t,e,r,a=[];return a[DSP.MIX]=function(t){for(var e=0,a=t.length/2;e<a;e++)r[e]=(t[2*e]+t[2*e+1])/2;return r},a[DSP.LEFT]=function(e){for(var r=0,a=e.length/2;r<a;r++)t[r]=e[2*r];return t},a[DSP.RIGHT]=function(t){for(var r=0,a=t.length/2;r<a;r++)e[r]=t[2*r+1];return e},function(s,n){return t=t||new Float32Array(n.length/2),e=e||new Float32Array(n.length/2),r=r||new Float32Array(n.length/2),n.length/2!==t.length&&(t=new Float32Array(n.length/2),e=new Float32Array(n.length/2),r=new Float32Array(n.length/2)),a[s](n)}}(),DSP.getChannel=DSP.deinterleave,DSP.mixSampleBuffers=function(t,e,r,a){for(var s=new Float32Array(t),n=0;n<t.length;n++)s[n]+=(r?-e[n]:e[n])/a;return s},DSP.LPF=0,DSP.HPF=1,DSP.BPF_CONSTANT_SKIRT=2,DSP.BPF_CONSTANT_PEAK=3,DSP.NOTCH=4,DSP.APF=5,DSP.PEAKING_EQ=6,DSP.LOW_SHELF=7,DSP.HIGH_SHELF=8,DSP.Q=1,DSP.BW=2,DSP.S=3,DSP.RMS=function(t){for(var e=0,r=0,a=t.length;r<a;r++)e+=t[r]*t[r];return Math.sqrt(e/a)},DSP.Peak=function(t){for(var e=0,r=0,a=t.length;r<a;r++)e=Math.abs(t[r])>e?Math.abs(t[r]):e;return e},DFT.prototype.forward=function(t){for(var e,r,a=this.real,s=this.imag,n=0;n<this.bufferSize/2;n++){e=0,r=0;for(var i=0;i<t.length;i++)e+=this.cosTable[n*i]*t[i],r+=this.sinTable[n*i]*t[i];a[n]=e,s[n]=r}return this.calculateSpectrum()},FFT.prototype.forward=function(t){var e=this.bufferSize,r=this.cosTable,a=this.sinTable,s=this.reverseTable,n=this.real,i=this.imag,o=(this.spectrum,Math.floor(Math.log(e)/Math.LN2));if(Math.pow(2,o)!==e)throw"Invalid buffer size, must be a power of 2.";if(e!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+e+" Buffer Size: "+t.length;var h,u,l,f,c,p,d,y,g,b=1;for(g=0;g<e;g++)n[g]=t[s[g]],i[g]=0;for(;b<e;){h=r[b],u=a[b],l=1,f=0;for(var _=0;_<b;_++){for(g=_;g<e;)c=g+b,p=l*n[c]-f*i[c],d=l*i[c]+f*n[c],n[c]=n[g]-p,i[c]=i[g]-d,n[g]+=p,i[g]+=d,g+=b<<1;y=l,l=y*h-f*u,f=y*u+f*h}b<<=1}return this.calculateSpectrum()},FFT.prototype.inverse=function(t,e){var r=this.bufferSize,a=this.cosTable,s=this.sinTable,n=this.reverseTable;this.spectrum;t=t||this.real,e=e||this.imag;var i,o,h,u,l,f,c,p,d,y=1;for(d=0;d<r;d++)e[d]*=-1;var g=new Float32Array(r),b=new Float32Array(r);for(d=0;d<t.length;d++)g[d]=t[n[d]],b[d]=e[n[d]];for(t=g,e=b;y<r;){i=a[y],o=s[y],h=1,u=0;for(var _=0;_<y;_++){for(d=_;d<r;)l=d+y,f=h*t[l]-u*e[l],c=h*e[l]+u*t[l],t[l]=t[d]-f,e[l]=e[d]-c,t[d]+=f,e[d]+=c,d+=y<<1;p=h,h=p*i-u*o,u=p*o+u*i}y<<=1}var v=new Float32Array(r);for(d=0;d<r;d++)v[d]=t[d]/r;return v},RFFT.prototype.forward=function(t){var e,r,a,s,n,i,o,h,u,l,f,c,p,d,y,g,b,_,v,m,w,S,A,P,I,E,T=this.bufferSize,F=this.spectrum,M=this.trans,D=2*Math.PI,R=Math.sqrt,L=T>>>1,B=2/T;this.reverseBinPermute(M,t);for(var O=0,N=4;O<T;N*=4){for(var V=O;V<T;V+=N)b=M[V]-M[V+1],M[V]+=M[V+1],M[V+1]=b;O=2*(N-1)}for(e=2,s=T>>>1;s>>>=1;){O=0,e<<=1,N=e<<1,r=e>>>2,a=e>>>3;do{if(1!==r)for(V=O;V<T;V+=N)u=V,l=u+r,f=l+r,c=f+r,n=M[f]+M[c],M[c]-=M[f],M[f]=M[u]-n,M[u]+=n,u+=a,l+=a,f+=a,c+=a,n=M[f]+M[c],i=M[f]-M[c],n=-n*Math.SQRT1_2,i*=Math.SQRT1_2,b=M[l],M[c]=n+b,M[f]=n-b,M[l]=M[u]-i,M[u]+=i;else for(V=O;V<T;V+=N)u=V,l=u+r,f=l+r,c=f+r,n=M[f]+M[c],M[c]-=M[f],M[f]=M[u]-n,M[u]+=n;O=(N<<1)-e,N<<=2}while(O<T);S=D/e;for(var U=1;U<a;U++){A=U*S,v=Math.sin(A),_=Math.cos(A),m=4*_*(_*_-.75),w=4*v*(.75-v*v),O=0,N=e<<1;do{for(V=O;V<T;V+=N)u=V+U,l=u+r,f=l+r,c=f+r,p=V+r-U,d=p+r,y=d+r,g=y+r,i=M[y]*_-M[f]*v,n=M[y]*v+M[f]*_,h=M[g]*m-M[c]*w,o=M[g]*w+M[c]*m,b=i-h,i+=h,h=b,M[g]=i+M[d],M[f]=i-M[d],b=o-n,n+=o,o=b,M[c]=o+M[l],M[y]=o-M[l],M[d]=M[u]-n,M[u]+=n,M[l]=h+M[p],M[p]-=h;O=(N<<1)-e,N<<=2}while(O<T)}}for(;--L;)P=M[L],I=M[T-L-1],E=B*R(P*P+I*I),E>this.peak&&(this.peakBand=L,this.peak=E),F[L]=E;return F[0]=B*M[0],F},Sampler.prototype.applyEnvelope=function(){return this.envelope.process(this.signal),this.signal},Sampler.prototype.generate=function(){for(var t=(this.frameCount*this.bufferSize,this.playEnd*this.samples.length-this.playStart*this.samples.length),e=this.playStart*this.samples.length,r=this.playEnd*this.samples.length,a=0;a<this.bufferSize;a++){switch(this.loopMode){case DSP.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+e),this.playhead<this.playEnd*this.samples.length?this.signal[a]=this.samples[this.playhead]*this.amplitude:this.signal[a]=0;break;case DSP.FW:this.playhead=Math.round(this.samplesProcessed*this.step%t+e),this.playhead<this.playEnd*this.samples.length&&(this.signal[a]=this.samples[this.playhead]*this.amplitude);break;case DSP.BW:this.playhead=r-Math.round(this.samplesProcessed*this.step%t),this.playhead<this.playEnd*this.samples.length&&(this.signal[a]=this.samples[this.playhead]*this.amplitude);break;case DSP.FWBW:Math.floor(this.samplesProcessed*this.step/t)%2===0?this.playhead=Math.round(this.samplesProcessed*this.step%t+e):this.playhead=r-Math.round(this.samplesProcessed*this.step%t),this.playhead<this.playEnd*this.samples.length&&(this.signal[a]=this.samples[this.playhead]*this.amplitude)}this.samplesProcessed++}return this.frameCount++,this.signal},Sampler.prototype.setFreq=function(t){var e=this.samplesProcessed*this.step;this.frequency=t,this.step=this.frequency/this.rootFrequency,this.samplesProcessed=Math.round(e/this.step)},Sampler.prototype.reset=function(){this.samplesProcessed=0,this.playhead=0},Oscillator.prototype.setAmp=function(t){if(!(t>=0&&t<=1))throw"Amplitude out of range (0..1).";this.amplitude=t},Oscillator.prototype.setFreq=function(t){this.frequency=t,this.cyclesPerSample=t/this.sampleRate},Oscillator.prototype.add=function(t){for(var e=0;e<this.bufferSize;e++)this.signal[e]+=t.signal[e];return this.signal},Oscillator.prototype.addSignal=function(t){for(var e=0;e<t.length&&!(e>=this.bufferSize);e++)this.signal[e]+=t[e];return this.signal},Oscillator.prototype.addEnvelope=function(t){this.envelope=t},Oscillator.prototype.applyEnvelope=function(){this.envelope.process(this.signal)},Oscillator.prototype.valueAt=function(t){return this.waveTable[t%this.waveTableLength]},Oscillator.prototype.generate=function(){for(var t,e=this.frameCount*this.bufferSize,r=this.waveTableLength*this.frequency/this.sampleRate,a=0;a<this.bufferSize;a++)t=Math.round((e+a)*r),this.signal[a]=this.waveTable[t%this.waveTableLength]*this.amplitude;return this.frameCount++,this.signal},Oscillator.Sine=function(t){return Math.sin(DSP.TWO_PI*t)},Oscillator.Square=function(t){return t<.5?1:-1},Oscillator.Saw=function(t){return 2*(t-Math.round(t))},Oscillator.Triangle=function(t){return 1-4*Math.abs(Math.round(t)-t)},Oscillator.Pulse=function(t){},ADSR.prototype.noteOn=function(){this.samplesProcessed=0,this.sustainSamples=this.sustainLength*this.sampleRate,this.update()},ADSR.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples,this.update()},ADSR.prototype.processSample=function(t){var e=0;return this.samplesProcessed<=this.attack?e=0+1*((this.samplesProcessed-0)/(this.attack-0)):this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?e=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?e=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(e=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),t*e},ADSR.prototype.value=function(){var t=0;return this.samplesProcessed<=this.attack?t=0+1*((this.samplesProcessed-0)/(this.attack-0)):this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?t=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?t=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(t=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),t},ADSR.prototype.process=function(t){for(var e=0;e<t.length;e++)t[e]*=this.value(),this.samplesProcessed++;return t},ADSR.prototype.isActive=function(){return!(this.samplesProcessed>this.release||this.samplesProcessed===-1)},ADSR.prototype.disable=function(){this.samplesProcessed=-1},IIRFilter.prototype.__defineGetter__("cutoff",function(){return this.func.cutoff}),IIRFilter.prototype.__defineGetter__("resonance",function(){return this.func.resonance}),IIRFilter.prototype.set=function(t,e){this.func.calcCoeff(t,e)},IIRFilter.prototype.process=function(t){this.func.process(t)},IIRFilter.prototype.addEnvelope=function(t){if(!(t instanceof ADSR))throw"Not an envelope.";this.func.addEnvelope(t)},IIRFilter.LP12=function(t,e,r){this.sampleRate=r,this.vibraPos=0,this.vibraSpeed=0,this.envelope=!1,this.calcCoeff=function(t,e){this.w=2*Math.PI*t/this.sampleRate,this.q=1-this.w/(2*(e+.5/(1+this.w))+this.w-2),this.r=this.q*this.q,this.c=this.r+1-2*Math.cos(this.w)*this.q,this.cutoff=t,this.resonance=e},this.calcCoeff(t,e),this.process=function(t){for(var e=0;e<t.length;e++)this.vibraSpeed+=(t[e]-this.vibraPos)*this.c,this.vibraPos+=this.vibraSpeed,this.vibraSpeed*=this.r,this.envelope?(t[e]=t[e]*(1-this.envelope.value())+this.vibraPos*this.envelope.value(),this.envelope.samplesProcessed++):t[e]=this.vibraPos}},IIRFilter.LP12.prototype.addEnvelope=function(t){this.envelope=t},IIRFilter2.prototype.process=function(t){for(var e,r,a=this.f,s=0;s<t.length;s++)e=t[s],a[3]=e-this.damp*a[2],a[0]=a[0]+this.freq*a[2],a[1]=a[3]-a[0],a[2]=this.freq*a[1]+a[2],r=.5*a[this.type],a[3]=e-this.damp*a[2],a[0]=a[0]+this.freq*a[2],a[1]=a[3]-a[0],a[2]=this.freq*a[1]+a[2],r+=.5*a[this.type],this.envelope?(t[s]=t[s]*(1-this.envelope.value())+r*this.envelope.value(),this.envelope.samplesProcessed++):t[s]=r},IIRFilter2.prototype.addEnvelope=function(t){if(!(t instanceof ADSR))throw"This is not an envelope.";this.envelope=t},IIRFilter2.prototype.set=function(t,e){this.calcCoeff(t,e)},WindowFunction.prototype.process=function(t){for(var e=t.length,r=0;r<e;r++)t[r]*=this.func(e,r,this.alpha);return t},WindowFunction.Bartlett=function(t,e){return 2/(t-1)*((t-1)/2-Math.abs(e-(t-1)/2))},WindowFunction.BartlettHann=function(t,e){return.62-.48*Math.abs(e/(t-1)-.5)-.38*Math.cos(DSP.TWO_PI*e/(t-1))},WindowFunction.Blackman=function(t,e,r){var a=(1-r)/2,s=.5,n=r/2;return a-s*Math.cos(DSP.TWO_PI*e/(t-1))+n*Math.cos(4*Math.PI*e/(t-1))},WindowFunction.Cosine=function(t,e){return Math.cos(Math.PI*e/(t-1)-Math.PI/2)},WindowFunction.Gauss=function(t,e,r){return Math.pow(Math.E,-.5*Math.pow((e-(t-1)/2)/(r*(t-1)/2),2))},WindowFunction.Hamming=function(t,e){return.54-.46*Math.cos(DSP.TWO_PI*e/(t-1))},WindowFunction.Hann=function(t,e){return.5*(1-Math.cos(DSP.TWO_PI*e/(t-1)))},WindowFunction.Lanczos=function(t,e){var r=2*e/(t-1)-1;return Math.sin(Math.PI*r)/(Math.PI*r)},WindowFunction.Rectangular=function(t,e){return 1},WindowFunction.Triangular=function(t,e){return 2/t*(t/2-Math.abs(e-(t-1)/2))},DSP.mag2db=function(t){for(var e=-120,r=Math.pow(10,e/20),a=Math.log,s=Math.max,n=Float32Array(t.length),i=0;i<t.length;i++)n[i]=20*a(s(t[i],r));return n},DSP.freqz=function(t,e,r){var a,s;if(!r)for(r=Float32Array(200),a=0;a<r.length;a++)r[a]=DSP.TWO_PI/r.length*a-Math.PI;var n=Float32Array(r.length),i=Math.sqrt,o=Math.cos,h=Math.sin;for(a=0;a<r.length;a++){var u={real:0,imag:0};for(s=0;s<t.length;s++)u.real+=t[s]*o(-s*r[a]),u.imag+=t[s]*h(-s*r[a]);var l={real:0,imag:0};for(s=0;s<e.length;s++)l.real+=e[s]*o(-s*r[a]),l.imag+=e[s]*h(-s*r[a]);n[a]=i(u.real*u.real+u.imag*u.imag)/i(l.real*l.real+l.imag*l.imag)}return n},MultiDelay.prototype.setDelayInSamples=function(t){this.delayInSamples=t,this.delayInputPointer=this.delayOutputPointer+t,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},MultiDelay.prototype.setMasterVolume=function(t){this.masterVolume=t},MultiDelay.prototype.setDelayVolume=function(t){this.delayVolume=t},MultiDelay.prototype.process=function(t){for(var e=new Float32Array(t.length),r=0;r<t.length;r++){var a=null===this.delayBufferSamples[this.delayOutputPointer]?0:this.delayBufferSamples[this.delayOutputPointer],s=a*this.delayVolume+t[r];this.delayBufferSamples[this.delayInputPointer]=s,e[r]=s*this.masterVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return e},SingleDelay.prototype.setDelayInSamples=function(t){this.delayInSamples=t,this.delayInputPointer=this.delayOutputPointer+t,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},SingleDelay.prototype.setDelayVolume=function(t){this.delayVolume=t},SingleDelay.prototype.process=function(t){for(var e=new Float32Array(t.length),r=0;r<t.length;r++){this.delayBufferSamples[this.delayInputPointer]=t[r];var a=this.delayBufferSamples[this.delayOutputPointer];e[r]=a*this.delayVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return e},Reverb.prototype.setDelayInSamples=function(t){this.delayInSamples=t;var e,r;for(e=0;e<this.NR_OF_SINGLEDELAYS;e++)r=1+e/7,this.singleDelays[e].setDelayInSamples(Math.round(this.delayInSamples*r));for(e=0;e<this.NR_OF_MULTIDELAYS;e++)r=1+e/10,this.multiDelays[e].setDelayInSamples(Math.round(this.delayInSamples*r))},Reverb.prototype.setMasterVolume=function(t){this.masterVolume=t},Reverb.prototype.setMixVolume=function(t){this.mixVolume=t},Reverb.prototype.setDelayVolume=function(t){this.delayVolume=t;var e;for(e=0;e<this.NR_OF_SINGLEDELAYS;e++)this.singleDelays[e].setDelayVolume(this.delayVolume);for(e=0;e<this.NR_OF_MULTIDELAYS;e++)this.multiDelays[e].setDelayVolume(this.delayVolume)},Reverb.prototype.setDampFrequency=function(t){this.dampFrequency=t,this.LOWPASSL.set(t,0),this.LOWPASSR.set(t,0)},Reverb.prototype.process=function(t){var e=new Float32Array(t.length),r=DSP.deinterleave(t);this.LOWPASSL.process(r[DSP.LEFT]),this.LOWPASSR.process(r[DSP.RIGHT]);var a,s=DSP.interleave(r[DSP.LEFT],r[DSP.RIGHT]);for(a=0;a<this.NR_OF_MULTIDELAYS;a++)e=DSP.mixSampleBuffers(e,this.multiDelays[a].process(s),2%a===0,this.NR_OF_MULTIDELAYS);var n=new Float32Array(e.length);for(a=0;a<this.NR_OF_SINGLEDELAYS;a++)n=DSP.mixSampleBuffers(n,this.singleDelays[a].process(e),2%a===0,1);for(a=0;a<n.length;a++)n[a]*=this.mixVolume;for(e=DSP.mixSampleBuffers(n,t,0,1),a=0;a<e.length;a++)e[a]*=this.masterVolume;return e},require=function t(e,r,a){function s(i,o){if(!r[i]){if(!e[i]){var h="function"==typeof require&&require;if(!o&&h)return h(i,!0);if(n)return n(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[i]={exports:{}};e[i][0].call(l.exports,function(t){var r=e[i][1][t];return s(r?r:t)},l,l.exports,t,e,r,a)}return r[i].exports}for(var n="function"==typeof require&&require,i=0;i<a.length;i++)s(a[i]);return s}({1:[function(t,e,r){function a(t,e,r,a,s,h,u){t|=0,e|=0,r|=0,s|=0,h|=0,o.isPow2(r)?n(t,e,r,a,s,h):i(t,e,r,a,s,h,u)}function s(t){return o.isPow2(t)?0:2*t+4*o.nextPow2(2*t+1)}function n(t,e,r,a,s,n){t|=0,e|=0,r|=0,s|=0,n|=0;var i,h,u,l,f,c,p,d,y,g,b,_,v,w,S,A,P,I,E,T,F,M,D,R;for(i=r,m=o.log2(i),P=0;P<e;++P){for(c=i>>1,l=0,h=0;h<i-1;h++){for(h<l&&(_=a[s+h],a[s+h]=a[s+l],a[s+l]=_,_=a[n+h],a[n+h]=a[n+l],a[n+l]=_),f=c;f<=l;)l-=f,f>>=1;l+=f}for(g=-1,b=0,y=1,p=0;p<m;p++){for(d=y,y<<=1,S=1,A=0,l=0;l<d;l++){for(h=l;h<i;h+=y)u=h+d,I=a[s+u],E=a[n+u],T=a[s+h],F=a[n+h],M=S*(I+E),D=I*(A-S),R=E*(S+A),v=M-R,w=M+D,a[s+u]=T-v,a[n+u]=F-w,a[s+h]+=v,a[n+h]+=w;M=g*(S+A),D=S*(b-g),R=A*(g+b),S=M-R,A=M+D}b=Math.sqrt((1-g)/2),t<0&&(b=-b),g=Math.sqrt((1+g)/2)}if(t<0){var L=1/i;for(h=0;h<i;h++)a[s+h]*=L,a[n+h]*=L}s+=r,n+=r}}function i(t,e,r,a,s,i,h){t|=0,e|=0,r|=0,s|=0,i|=0,h|=0;var u,l,f,c,p,d,y,g,b,_=o.nextPow2(2*r+1),v=h,m=v+r,w=m+r,S=w+_,A=S+_,P=A+_,I=-t*Math.PI/r;for(b=0;b<r;++b)l=I*(b*b%(2*r)),c=Math.cos(l),p=Math.sin(l),a[A+(_-b)]=a[A+b]=a[v+b]=c,a[P+(_-b)]=a[P+b]=a[m+b]=p;for(b=r;b<=_-r;++b)a[A+b]=0;for(b=r;b<=_-r;++b)a[P+b]=0;for(n(1,1,_,a,A,P),I=t<0?1/r:1,u=0;u<e;++u){for(b=0;b<r;++b)l=a[s+b],f=a[i+b],c=a[v+b],p=-a[m+b],d=c*(l+f),y=l*(p-c),g=f*(c+p),a[w+b]=d-g,a[S+b]=d+y;for(b=r;b<_;++b)a[w+b]=0;for(b=r;b<_;++b)a[S+b]=0;for(n(1,1,_,a,w,S),b=0;b<_;++b)l=a[w+b],f=a[S+b],c=a[A+b],p=a[P+b],d=c*(l+f),y=l*(p-c),g=f*(c+p),a[w+b]=d-g,a[S+b]=d+y;for(n(-1,1,_,a,w,S),b=0;b<r;++b)l=a[w+b],f=a[S+b],c=a[v+b],p=-a[m+b],d=c*(l+f),y=l*(p-c),g=f*(c+p),a[s+b]=I*(d-g),a[i+b]=I*(d+y);s+=r,i+=r}}var o=t("bit-twiddle");e.exports=a,e.exports.scratchMemory=s},{"bit-twiddle":2}],2:[function(t,e,r){"use strict";"use restrict";function a(t){var e=32;return t&=-t,t&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}var s=32;r.INT_BITS=s,r.INT_MAX=2147483647,r.INT_MIN=-1<<s-1,r.sign=function(t){return(t>0)-(t<0)},r.abs=function(t){var e=t>>s-1;return(t^e)-e},r.min=function(t,e){return e^(t^e)&-(t<e)},r.max=function(t,e){return t^(t^e)&-(t<e)},r.isPow2=function(t){return!(t&t-1||!t)},r.log2=function(t){var e,r;return e=(t>65535)<<4,t>>>=e,r=(t>255)<<3,t>>>=r,e|=r,r=(t>15)<<2,t>>>=r,e|=r,r=(t>3)<<1,t>>>=r,e|=r,e|t>>1},r.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},r.popCount=function(t){return t-=t>>>1&1431655765,t=(858993459&t)+(t>>>2&858993459),16843009*(t+(t>>>4)&252645135)>>>24},r.countTrailingZeros=a,r.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1},r.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t-(t>>>1)},r.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,t&=15,27030>>>t&1};var n=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,a=e,s=7;for(r>>>=1;r;r>>>=1)a<<=1,a|=1&r,--s;t[e]=a<<s&255}}(n),r.reverse=function(t){return n[255&t]<<24|n[t>>>8&255]<<16|n[t>>>16&255]<<8|n[t>>>24&255]},r.interleave2=function(t,e){return t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},r.deinterleave2=function(t,e){return t=t>>>e&1431655765,t=858993459&(t|t>>>1),t=252645135&(t|t>>>2),t=16711935&(t|t>>>4),t=65535&(t|t>>>16),t<<16>>16},r.interleave3=function(t,e,r){return t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t|=e<<1,r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),t|r<<2},r.deinterleave3=function(t,e){return t=t>>>e&1227133513,t=3272356035&(t|t>>>2),t=251719695&(t|t>>>4),t=4278190335&(t|t>>>8),t=1023&(t|t>>>16),t<<22>>22},r.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>a(t)+1}},{}],3:[function(t,e,r){"use strict";function a(t){if(!t)return o;for(var e=0;e<t.args.length;++e){var r=t.args[e];0===e?t.args[e]={name:r,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:t.args[e]={name:r,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function s(t){return i({args:t.args,pre:a(t.pre),body:a(t.body),post:a(t.proc),funcName:t.funcName})}function n(t){for(var e=[],r=0;r<t.args.length;++r)e.push("a"+r);var a=new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""));
return a(s(t))}var i=t("cwise-compiler"),o={body:"",args:[],thisVars:[],localVars:[]},h={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in h){var e=h[t];r[t]=n({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+e+"c"},funcName:t}),r[t+"eq"]=n({args:["array","array"],body:{args:["a","b"],body:"a"+e+"=b"},rvalue:!0,funcName:t+"eq"}),r[t+"s"]=n({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+e+"s"},funcName:t+"s"}),r[t+"seq"]=n({args:["array","scalar"],body:{args:["a","s"],body:"a"+e+"=s"},rvalue:!0,funcName:t+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in u){var e=u[t];r[t]=n({args:["array","array"],body:{args:["a","b"],body:"a="+e+"b"},funcName:t}),r[t+"eq"]=n({args:["array"],body:{args:["a"],body:"a="+e+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in l){var e=l[t];r[t]=n({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+e+"c"},funcName:t}),r[t+"s"]=n({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+e+"s"},funcName:t+"s"}),r[t+"eq"]=n({args:["array","array"],body:{args:["a","b"],body:"a=a"+e+"b"},rvalue:!0,count:2,funcName:t+"eq"}),r[t+"seq"]=n({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+e+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var f=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<f.length;++t){var e=f[t];r[e]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:e}),r[e+"eq"]=n({args:["array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:e+"eq"})}}();var c=["max","min","atan2","pow"];!function(){for(var t=0;t<c.length;++t){var e=c[t];r[e]=n({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:e}),r[e+"s"]=n({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:e+"s"}),r[e+"eq"]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:e+"eq"}),r[e+"seq"]=n({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:e+"seq"})}}();var p=["atan2","pow"];!function(){for(var t=0;t<p.length;++t){var e=p[t];r[e+"op"]=n({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:e+"op"}),r[e+"ops"]=n({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:e+"ops"}),r[e+"opeq"]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:e+"opeq"}),r[e+"opseq"]=n({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+e,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:e+"opseq"})}}(),r.any=i({args:["array"],pre:o,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),r.all=i({args:["array"],pre:o,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),r.sum=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),r.prod=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),r.norm2squared=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),r.norm2=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),r.norminf=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),r.norm1=i({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),r.sup=i({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.inf=i({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.argmin=i({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.argmax=i({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.random=n({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),r.assign=n({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),r.assigns=n({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),r.equals=i({args:["array","array"],pre:o,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":4}],4:[function(t,e,r){"use strict";function a(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function s(t){var e=new a;e.pre=t.pre,e.body=t.body,e.post=t.post;var r=t.args.slice(0);e.argTypes=r;for(var s=0;s<r.length;++s){var i=r[s];if("array"===i){if(e.arrayArgs.push(s),e.shimArgs.push("array"+s),s<e.pre.args.length&&e.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array args");if(s<e.post.args.length&&e.post.args[s].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)e.scalarArgs.push(s),e.shimArgs.push("scalar"+s);else if("index"===i){if(e.indexArgs.push(s),s<e.pre.args.length&&e.pre.args[s].count>0)throw new Error("cwise: pre() block may not reference array index");if(s<e.body.args.length&&e.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array index");if(s<e.post.args.length&&e.post.args[s].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(e.shapeArgs.push(s),s<e.pre.args.length&&e.pre.args[s].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(s<e.body.args.length&&e.body.args[s].lvalue)throw new Error("cwise: body() block may not write to array shape");if(s<e.post.args.length&&e.post.args[s].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[s]);e.argTypes[s]="offset",e.offsetArgs.push({array:i.array,offset:i.offset}),e.offsetArgIndex.push(s)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,n(e)}var n=t("./lib/thunk.js");e.exports=s},{"./lib/thunk.js":6}],5:[function(t,e,r){"use strict";function a(t,e,r){var a,s,n=t.length,i=e.arrayArgs.length,o=e.indexArgs.length>0,h=[],u=[],l=0,f=0;for(a=0;a<n;++a)u.push(["i",a,"=0"].join(""));for(s=0;s<i;++s)for(a=0;a<n;++a)f=l,l=t[a],0===a?u.push(["d",s,"s",a,"=t",s,"p",l].join("")):u.push(["d",s,"s",a,"=(t",s,"p",l,"-s",f,"*t",s,"p",f,")"].join(""));for(h.push("var "+u.join(",")),a=n-1;a>=0;--a)l=t[a],h.push(["for(i",a,"=0;i",a,"<s",l,";++i",a,"){"].join(""));for(h.push(r),a=0;a<n;++a){for(f=l,l=t[a],s=0;s<i;++s)h.push(["p",s,"+=d",s,"s",a].join(""));o&&(a>0&&h.push(["index[",f,"]-=s",f].join("")),h.push(["++index[",l,"]"].join(""))),h.push("}")}return h.join("\n")}function s(t,e,r,s){for(var n=e.length,i=r.arrayArgs.length,o=r.blockSize,h=r.indexArgs.length>0,u=[],l=0;l<i;++l)u.push(["var offset",l,"=p",l].join(""));for(var l=t;l<n;++l)u.push(["for(var j"+l+"=SS[",e[l],"]|0;j",l,">0;){"].join("")),u.push(["if(j",l,"<",o,"){"].join("")),u.push(["s",e[l],"=j",l].join("")),u.push(["j",l,"=0"].join("")),u.push(["}else{s",e[l],"=",o].join("")),u.push(["j",l,"-=",o,"}"].join("")),h&&u.push(["index[",e[l],"]=j",l].join(""));for(var l=0;l<i;++l){for(var f=["offset"+l],c=t;c<n;++c)f.push(["j",c,"*t",l,"p",e[c]].join(""));u.push(["p",l,"=(",f.join("+"),")"].join(""))}u.push(a(e,r,s));for(var l=t;l<n;++l)u.push("}");return u.join("\n")}function n(t){for(var e=0,r=t[0].length;e<r;){for(var a=1;a<t.length;++a)if(t[a][e]!==t[0][e])return e;++e}return e}function i(t,e,r){for(var a=t.body,s=[],n=[],i=0;i<t.args.length;++i){var o=t.args[i];if(!(o.count<=0)){var h=new RegExp(o.name,"g"),u="",l=e.arrayArgs.indexOf(i);switch(e.argTypes[i]){case"offset":var f=e.offsetArgIndex.indexOf(i),c=e.offsetArgs[f];l=c.array,u="+q"+f;case"array":u="p"+l+u;var p="l"+i,d="a"+l;1===o.count?"generic"===r[l]?o.lvalue?(s.push(["var ",p,"=",d,".get(",u,")"].join("")),a=a.replace(h,p),n.push([d,".set(",u,",",p,")"].join(""))):a=a.replace(h,[d,".get(",u,")"].join("")):a=a.replace(h,[d,"[",u,"]"].join("")):"generic"===r[l]?(s.push(["var ",p,"=",d,".get(",u,")"].join("")),a=a.replace(h,p),o.lvalue&&n.push([d,".set(",u,",",p,")"].join(""))):(s.push(["var ",p,"=",d,"[",u,"]"].join("")),a=a.replace(h,p),o.lvalue&&n.push([d,"[",u,"]=",p].join("")));break;case"scalar":a=a.replace(h,"Y"+e.scalarArgs.indexOf(i));break;case"index":a=a.replace(h,"index");break;case"shape":a=a.replace(h,"shape")}}}return[s.join("\n"),a,n.join("\n")].join("\n").trim()}function o(t){for(var e=new Array(t.length),r=!0,a=0;a<t.length;++a){var s=t[a],n=s.match(/\d+/);n=n?n[0]:"",0===s.charAt(0)?e[a]="u"+s.charAt(1)+n:e[a]=s.charAt(0)+n,a>0&&(r=r&&e[a]===e[a-1])}return r?e[0]:e.join("")}function h(t,e){for(var r=0|e[1].length,h=new Array(t.arrayArgs.length),l=new Array(t.arrayArgs.length),f=["SS"],c=["'use strict'"],p=[],d=0;d<r;++d)p.push(["s",d,"=SS[",d,"]"].join(""));for(var y=0;y<t.arrayArgs.length;++y){f.push("a"+y),f.push("t"+y),f.push("p"+y),l[y]=e[2*y],h[y]=e[2*y+1];for(var d=0;d<r;++d)p.push(["t",y,"p",d,"=t",y,"[",d,"]"].join(""))}for(var y=0;y<t.scalarArgs.length;++y)f.push("Y"+y);if(t.shapeArgs.length>0&&p.push("shape=SS.slice(0)"),t.indexArgs.length>0){for(var g=new Array(r),y=0;y<r;++y)g[y]="0";p.push(["index=[",g.join(","),"]"].join(""))}for(var y=0;y<t.offsetArgs.length;++y){for(var b=t.offsetArgs[y],_=[],d=0;d<b.offset.length;++d)0!==b.offset[d]&&(1===b.offset[d]?_.push(["t",b.array,"p",d].join("")):_.push([b.offset[d],"*t",b.array,"p",d].join("")));0===_.length?p.push("q"+y+"=0"):p.push(["q",y,"=",_.join("+")].join(""))}var v=u([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));p=p.concat(v),c.push("var "+p.join(","));for(var y=0;y<t.arrayArgs.length;++y)c.push("p"+y+"|=0");t.pre.body.length>3&&c.push(i(t.pre,t,l));var m=i(t.body,t,l),w=n(h);w<r?c.push(s(w,h[0],t,m)):c.push(a(h[0],t,m)),t.post.body.length>3&&c.push(i(t.post,t,l)),t.debug&&console.log("Generated cwise routine for ",e,":\n\n",c.join("\n"));var S=[t.funcName||"unnamed","_cwise_loop_",h[0].join("s"),"m",w,o(l)].join(""),A=new Function(["function ",S,"(",f.join(","),"){",c.join("\n"),"} return ",S].join(""));return A()}var u=t("uniq");e.exports=h},{uniq:7}],6:[function(t,e,r){"use strict";function a(t){var e=["'use strict'","var CACHED={}"],r=[],a=t.funcName+"_cwise_thunk";e.push(["return function ",a,"(",t.shimArgs.join(","),"){"].join(""));for(var n=[],i=[],o=[["array",t.arrayArgs[0],".shape"].join("")],h=0;h<t.arrayArgs.length;++h){var u=t.arrayArgs[h];r.push(["t",u,"=array",u,".dtype,","r",u,"=array",u,".order"].join("")),n.push("t"+u),n.push("r"+u),i.push("t"+u),i.push("r"+u+".join()"),o.push("array"+u+".data"),o.push("array"+u+".stride"),o.push("array"+u+".offset|0")}for(var h=0;h<t.scalarArgs.length;++h)o.push("scalar"+t.scalarArgs[h]);r.push(["type=[",i.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),e.push("var "+r.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",o.join(","),")}"].join("")),t.debug&&console.log("Generated thunk:",e.join("\n"));var l=new Function("compile",e.join("\n"));return l(s.bind(void 0,t))}var s=t("./compile.js");e.exports=a},{"./compile.js":5}],7:[function(t,e,r){"use strict";function a(t,e){for(var r=1,a=t.length,s=t[0],n=t[0],i=1;i<a;++i)if(n=s,s=t[i],e(s,n)){if(i===r){r++;continue}t[r++]=s}return t.length=r,t}function s(t){for(var e=1,r=t.length,a=t[0],s=t[0],n=1;n<r;++n,s=a)if(s=a,a=t[n],a!==s){if(n===e){e++;continue}t[e++]=a}return t.length=e,t}function n(t,e,r){return 0===t.length?t:e?(r||t.sort(e),a(t,e)):(r||t.sort(),s(t))}e.exports=n},{}],8:[function(t,e,r){"use strict";function a(t,e,r){var s=0|t[r];if(s<=0)return[];var n,i=new Array(s);if(r===t.length-1)for(n=0;n<s;++n)i[n]=e;else for(n=0;n<s;++n)i[n]=a(t,e,r+1);return i}function s(t,e){var r,a;for(r=new Array(t),a=0;a<t;++a)r[a]=e;return r}function n(t,e){switch("undefined"==typeof e&&(e=0),typeof t){case"number":if(t>0)return s(0|t,e);break;case"object":if("number"==typeof t.length)return a(t,e,0)}return[]}e.exports=n},{}],9:[function(t,e,r){(function(e,a){"use strict";function s(t){if(t){var e=t.length||t.byteLength,r=_.log2(e);S[r].push(t)}}function n(t){s(t.buffer)}function i(t){var t=_.nextPow2(t),e=_.log2(t),r=S[e];return r.length>0?r.pop():new ArrayBuffer(t)}function o(t){return new Uint8Array(i(t),0,t)}function h(t){return new Uint16Array(i(2*t),0,t)}function u(t){return new Uint32Array(i(4*t),0,t)}function l(t){return new Int8Array(i(t),0,t)}function f(t){return new Int16Array(i(2*t),0,t)}function c(t){return new Int32Array(i(4*t),0,t)}function p(t){return new Float32Array(i(4*t),0,t)}function d(t){return new Float64Array(i(8*t),0,t)}function y(t){return m?new Uint8ClampedArray(i(t),0,t):o(t)}function g(t){return new DataView(i(t),0,t)}function b(t){t=_.nextPow2(t);var e=_.log2(t),r=A[e];return r.length>0?r.pop():new a(t)}var _=t("bit-twiddle"),v=t("dup");e.__TYPEDARRAY_POOL||(e.__TYPEDARRAY_POOL={UINT8:v([32,0]),UINT16:v([32,0]),UINT32:v([32,0]),INT8:v([32,0]),INT16:v([32,0]),INT32:v([32,0]),FLOAT:v([32,0]),DOUBLE:v([32,0]),DATA:v([32,0]),UINT8C:v([32,0]),BUFFER:v([32,0])});var m="undefined"!=typeof Uint8ClampedArray,w=e.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=v([32,0])),w.BUFFER||(w.BUFFER=v([32,0]));var S=w.DATA,A=w.BUFFER;r.free=function(t){if(a.isBuffer(t))A[_.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,r=0|_.log2(e);S[r].push(t)}},r.freeUint8=r.freeUint16=r.freeUint32=r.freeInt8=r.freeInt16=r.freeInt32=r.freeFloat32=r.freeFloat=r.freeFloat64=r.freeDouble=r.freeUint8Clamped=r.freeDataView=n,r.freeArrayBuffer=s,r.freeBuffer=function(t){A[_.log2(t.length)].push(t)},r.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return i(t);switch(e){case"uint8":return o(t);case"uint16":return h(t);case"uint32":return u(t);case"int8":return l(t);case"int16":return f(t);case"int32":return c(t);case"float":case"float32":return p(t);case"double":case"float64":return d(t);case"uint8_clamped":return y(t);case"buffer":return b(t);case"data":case"dataview":return g(t);default:return null}return null},r.mallocArrayBuffer=i,r.mallocUint8=o,r.mallocUint16=h,r.mallocUint32=u,r.mallocInt8=l,r.mallocInt16=f,r.mallocInt32=c,r.mallocFloat32=r.mallocFloat=p,r.mallocFloat64=r.mallocDouble=d,r.mallocUint8Clamped=y,r.mallocDataView=g,r.mallocBuffer=b,r.clearCache=function(){for(var t=0;t<32;++t)w.UINT8[t].length=0,w.UINT16[t].length=0,w.UINT32[t].length=0,w.INT8[t].length=0,w.INT16[t].length=0,w.INT32[t].length=0,w.FLOAT[t].length=0,w.DOUBLE[t].length=0,w.UINT8C[t].length=0,S[t].length=0,A[t].length=0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{"bit-twiddle":2,buffer:11,dup:8}],10:[function(t,e,r){"use strict";function a(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e}e.exports=a},{}],11:[function(t,e,r){function a(t,e){var r=this;if(!(r instanceof a))return new a(t,e);var s,n=typeof t;if("number"===n)s=+t;else if("string"===n)s=a.byteLength(t,e);else{if("object"!==n||null===t)throw new TypeError("must start with number, buffer, array or string");"Buffer"===t.type&&V(t.data)&&(t=t.data),s=+t.length}if(s>U)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+U.toString(16)+" bytes");s<0?s=0:s>>>=0,a.TYPED_ARRAY_SUPPORT?r=a._augment(new Uint8Array(s)):(r.length=s,r._isBuffer=!0);var i;if(a.TYPED_ARRAY_SUPPORT&&"number"==typeof t.byteLength)r._set(t);else if(E(t))if(a.isBuffer(t))for(i=0;i<s;i++)r[i]=t.readUInt8(i);else for(i=0;i<s;i++)r[i]=(t[i]%256+256)%256;else if("string"===n)r.write(t,0,e);else if("number"===n&&!a.TYPED_ARRAY_SUPPORT)for(i=0;i<s;i++)r[i]=0;return s>0&&s<=a.poolSize&&(r.parent=j),r}function s(t,e){if(!(this instanceof s))return new s(t,e);var r=new a(t,e);return delete r.parent,r}function n(t,e,r,a){r=Number(r)||0;var s=t.length-r;a?(a=Number(a),a>s&&(a=s)):a=s;var n=e.length;if(n%2!==0)throw new Error("Invalid hex string");a>n/2&&(a=n/2);for(var i=0;i<a;i++){var o=parseInt(e.substr(2*i,2),16);if(isNaN(o))throw new Error("Invalid hex string");t[r+i]=o}return i}function i(t,e,r,a){var s=L(F(e,t.length-r),t,r,a);return s}function o(t,e,r,a){var s=L(M(e),t,r,a);return s}function h(t,e,r,a){return o(t,e,r,a)}function u(t,e,r,a){var s=L(R(e),t,r,a);return s}function l(t,e,r,a){var s=L(D(e,t.length-r),t,r,a);return s}function f(t,e,r){return 0===e&&r===t.length?O.fromByteArray(t):O.fromByteArray(t.slice(e,r))}function c(t,e,r){var a="",s="";r=Math.min(t.length,r);for(var n=e;n<r;n++)t[n]<=127?(a+=B(s)+String.fromCharCode(t[n]),s=""):s+="%"+t[n].toString(16);return a+B(s)}function p(t,e,r){var a="";r=Math.min(t.length,r);for(var s=e;s<r;s++)a+=String.fromCharCode(127&t[s]);return a}function d(t,e,r){var a="";r=Math.min(t.length,r);for(var s=e;s<r;s++)a+=String.fromCharCode(t[s]);return a}function y(t,e,r){var a=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>a)&&(r=a);for(var s="",n=e;n<r;n++)s+=T(t[n]);return s}function g(t,e,r){for(var a=t.slice(e,r),s="",n=0;n<a.length;n+=2)s+=String.fromCharCode(a[n]+256*a[n+1]);return s}function b(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function _(t,e,r,s,n,i){if(!a.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>n||e<i)throw new RangeError("value is out of bounds");if(r+s>t.length)throw new RangeError("index out of range")}function v(t,e,r,a){e<0&&(e=65535+e+1);for(var s=0,n=Math.min(t.length-r,2);s<n;s++)t[r+s]=(e&255<<8*(a?s:1-s))>>>8*(a?s:1-s)}function m(t,e,r,a){e<0&&(e=4294967295+e+1);for(var s=0,n=Math.min(t.length-r,4);s<n;s++)t[r+s]=e>>>8*(a?s:3-s)&255}function w(t,e,r,a,s,n){if(e>s||e<n)throw new RangeError("value is out of bounds");if(r+a>t.length)throw new RangeError("index out of range");if(r<0)throw new RangeError("index out of range")}function S(t,e,r,a,s){return s||w(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),N.write(t,e,r,a,23,4),r+4}function A(t,e,r,a,s){return s||w(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),N.write(t,e,r,a,52,8),r+8}function P(t){if(t=I(t).replace(k,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function I(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function E(t){return V(t)||a.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function T(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){e=e||1/0;for(var r,a=t.length,s=null,n=[],i=0;i<a;i++){if(r=t.charCodeAt(i),r>55295&&r<57344){if(!s){if(r>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(i+1===a){(e-=3)>-1&&n.push(239,191,189);continue}s=r;continue}if(r<56320){(e-=3)>-1&&n.push(239,191,189),s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&((e-=3)>-1&&n.push(239,191,189),s=null);if(r<128){if((e-=1)<0)break;n.push(r)}else if(r<2048){if((e-=2)<0)break;n.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;n.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<2097152))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return n}function M(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}function D(t,e){for(var r,a,s,n=[],i=0;i<t.length&&!((e-=2)<0);i++)r=t.charCodeAt(i),a=r>>8,s=r%256,n.push(s),n.push(a);return n}function R(t){return O.toByteArray(P(t))}function L(t,e,r,a){for(var s=0;s<a&&!(s+r>=e.length||s>=t.length);s++)e[s+r]=t[s];return s}function B(t){try{return decodeURIComponent(t)}catch(t){return String.fromCharCode(65533)}}var O=t("base64-js"),N=t("ieee754"),V=t("is-array");r.Buffer=a,r.SlowBuffer=s,r.INSPECT_MAX_BYTES=50,a.poolSize=8192;var U=1073741823,j={};a.TYPED_ARRAY_SUPPORT=function(){try{var t=new ArrayBuffer(0),e=new Uint8Array(t);return e.foo=function(){return 42},42===e.foo()&&"function"==typeof e.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(t){return!1}}(),a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,s=e.length,n=0,i=Math.min(r,s);n<i&&t[n]===e[n];n++);return n!==i&&(r=t[n],s=e[n]),r<s?-1:s<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!V(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new a(0);if(1===t.length)return t[0];var r;if(void 0===e)for(e=0,r=0;r<t.length;r++)e+=t[r].length;var s=new a(e),n=0;for(r=0;r<t.length;r++){var i=t[r];i.copy(s,n),n+=i.length}return s},a.byteLength=function(t,e){var r;switch(t+="",e||"utf8"){case"ascii":case"binary":case"raw":r=t.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*t.length;break;case"hex":r=t.length>>>1;break;case"utf8":case"utf-8":r=F(t).length;break;case"base64":r=R(t).length;break;default:r=t.length}return r},a.prototype.length=void 0,a.prototype.parent=void 0,a.prototype.toString=function(t,e,r){var a=!1;if(e>>>=0,r=void 0===r||r===1/0?this.length:r>>>0,t||(t="utf8"),e<0&&(e=0),r>this.length&&(r=this.length),r<=e)return"";for(;;)switch(t){case"hex":return y(this,e,r);case"utf8":case"utf-8":return c(this,e,r);case"ascii":return p(this,e,r);case"binary":return d(this,e,r);case"base64":return f(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,r);default:if(a)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),a=!0}},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:a.compare(this,t)},a.prototype.indexOf=function(t,e){function r(t,e,r){for(var a=-1,s=0;r+s<t.length;s++)if(t[r+s]===e[a===-1?0:s-a]){if(a===-1&&(a=s),s-a+1===e.length)return r+a}else a=-1;return-1}if(e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(e<0&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(a.isBuffer(t))return r(this,t,e);if("number"==typeof t)return a.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):r(this,[t],e);throw new TypeError("val must be string, number or Buffer")},a.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},a.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},a.prototype.write=function(t,e,r,a){if(isFinite(e))isFinite(r)||(a=r,r=void 0);else{var s=a;a=e,e=r,r=s}if(e=Number(e)||0,r<0||e<0||e>this.length)throw new RangeError("attempt to write outside buffer bounds");var f=this.length-e;r?(r=Number(r),r>f&&(r=f)):r=f,a=String(a||"utf8").toLowerCase();var c;switch(a){case"hex":c=n(this,t,e,r);break;case"utf8":case"utf-8":c=i(this,t,e,r);break;case"ascii":c=o(this,t,e,r);break;case"binary":c=h(this,t,e,r);break;case"base64":c=u(this,t,e,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=l(this,t,e,r);break;default:throw new TypeError("Unknown encoding: "+a)}return c},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var s;if(a.TYPED_ARRAY_SUPPORT)s=a._augment(this.subarray(t,e));else{var n=e-t;s=new a(n,void 0);for(var i=0;i<n;i++)s[i]=this[i+t]}return s.length&&(s.parent=this.parent||this),s},a.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var a=this[t],s=1,n=0;++n<e&&(s*=256);)a+=this[t+n]*s;return a},a.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var a=this[t+--e],s=1;e>0&&(s*=256);)a+=this[t+--e]*s;return a},a.prototype.readUInt8=function(t,e){return e||b(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||b(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||b(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var a=this[t],s=1,n=0;++n<e&&(s*=256);)a+=this[t+n]*s;return s*=128,a>=s&&(a-=Math.pow(2,8*e)),a},a.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var a=e,s=1,n=this[t+--a];a>0&&(s*=256);)n+=this[t+--a]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*e)),n},a.prototype.readInt8=function(t,e){return e||b(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},a.prototype.readInt16LE=function(t,e){e||b(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(t,e){e||b(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(t,e){return e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||b(t,4,this.length),N.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||b(t,4,this.length),N.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||b(t,8,this.length),N.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||b(t,8,this.length),N.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,r,a){t=+t,e>>>=0,r>>>=0,a||_(this,t,e,r,Math.pow(2,8*r),0);var s=1,n=0;for(this[e]=255&t;++n<r&&(s*=256);)this[e+n]=t/s>>>0&255;return e+r},a.prototype.writeUIntBE=function(t,e,r,a){t=+t,e>>>=0,r>>>=0,a||_(this,t,e,r,Math.pow(2,8*r),0);var s=r-1,n=1;for(this[e+s]=255&t;--s>=0&&(n*=256);)this[e+s]=t/n>>>0&255;return e+r},a.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=t,e+1},a.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):v(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):v(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t):m(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,r){
return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):m(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,r,a){t=+t,e>>>=0,a||_(this,t,e,r,Math.pow(2,8*r-1)-1,-Math.pow(2,8*r-1));var s=0,n=1,i=t<0?1:0;for(this[e]=255&t;++s<r&&(n*=256);)this[e+s]=(t/n>>0)-i&255;return e+r},a.prototype.writeIntBE=function(t,e,r,a){t=+t,e>>>=0,a||_(this,t,e,r,Math.pow(2,8*r-1)-1,-Math.pow(2,8*r-1));var s=r-1,n=1,i=t<0?1:0;for(this[e+s]=255&t;--s>=0&&(n*=256);)this[e+s]=(t/n>>0)-i&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):v(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):v(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):m(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):m(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,r){return S(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return S(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return A(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return A(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,s){if(r||(r=0),s||0===s||(s=this.length),e>=t.length&&(e=t.length),e||(e=0),s>0&&s<r&&(s=r),s===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),t.length-e<s-r&&(s=t.length-e+r);var n=s-r;if(n<1e3||!a.TYPED_ARRAY_SUPPORT)for(var i=0;i<n;i++)t[i+e]=this[i+r];else t._set(this.subarray(r,r+n),e);return n},a.prototype.fill=function(t,e,r){if(t||(t=0),e||(e=0),r||(r=this.length),r<e)throw new RangeError("end < start");if(r!==e&&0!==this.length){if(e<0||e>=this.length)throw new RangeError("start out of bounds");if(r<0||r>this.length)throw new RangeError("end out of bounds");var a;if("number"==typeof t)for(a=e;a<r;a++)this[a]=t;else{var s=F(t.toString()),n=s.length;for(a=e;a<r;a++)this[a]=s[a%n]}return this}},a.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(a.TYPED_ARRAY_SUPPORT)return new a(this).buffer;for(var t=new Uint8Array(this.length),e=0,r=t.length;e<r;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var x=a.prototype;a._augment=function(t){return t.constructor=a,t._isBuffer=!0,t._set=t.set,t.get=x.get,t.set=x.set,t.write=x.write,t.toString=x.toString,t.toLocaleString=x.toString,t.toJSON=x.toJSON,t.equals=x.equals,t.compare=x.compare,t.indexOf=x.indexOf,t.copy=x.copy,t.slice=x.slice,t.readUIntLE=x.readUIntLE,t.readUIntBE=x.readUIntBE,t.readUInt8=x.readUInt8,t.readUInt16LE=x.readUInt16LE,t.readUInt16BE=x.readUInt16BE,t.readUInt32LE=x.readUInt32LE,t.readUInt32BE=x.readUInt32BE,t.readIntLE=x.readIntLE,t.readIntBE=x.readIntBE,t.readInt8=x.readInt8,t.readInt16LE=x.readInt16LE,t.readInt16BE=x.readInt16BE,t.readInt32LE=x.readInt32LE,t.readInt32BE=x.readInt32BE,t.readFloatLE=x.readFloatLE,t.readFloatBE=x.readFloatBE,t.readDoubleLE=x.readDoubleLE,t.readDoubleBE=x.readDoubleBE,t.writeUInt8=x.writeUInt8,t.writeUIntLE=x.writeUIntLE,t.writeUIntBE=x.writeUIntBE,t.writeUInt16LE=x.writeUInt16LE,t.writeUInt16BE=x.writeUInt16BE,t.writeUInt32LE=x.writeUInt32LE,t.writeUInt32BE=x.writeUInt32BE,t.writeIntLE=x.writeIntLE,t.writeIntBE=x.writeIntBE,t.writeInt8=x.writeInt8,t.writeInt16LE=x.writeInt16LE,t.writeInt16BE=x.writeInt16BE,t.writeInt32LE=x.writeInt32LE,t.writeInt32BE=x.writeInt32BE,t.writeFloatLE=x.writeFloatLE,t.writeFloatBE=x.writeFloatBE,t.writeDoubleLE=x.writeDoubleLE,t.writeDoubleBE=x.writeDoubleBE,t.fill=x.fill,t.inspect=x.inspect,t.toArrayBuffer=x.toArrayBuffer,t};var k=/[^+\/0-9A-z\-]/g},{"base64-js":12,ieee754:13,"is-array":14}],12:[function(t,e,r){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function e(t){var e=t.charCodeAt(0);return e===i||e===f?62:e===o||e===c?63:e<h?-1:e<h+10?e-h+26+26:e<l+26?e-l:e<u+26?e-u+26:void 0}function r(t){function r(t){u[f++]=t}var a,s,i,o,h,u;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=t.length;h="="===t.charAt(l-2)?2:"="===t.charAt(l-1)?1:0,u=new n(3*t.length/4-h),i=h>0?t.length-4:t.length;var f=0;for(a=0,s=0;a<i;a+=4,s+=3)o=e(t.charAt(a))<<18|e(t.charAt(a+1))<<12|e(t.charAt(a+2))<<6|e(t.charAt(a+3)),r((16711680&o)>>16),r((65280&o)>>8),r(255&o);return 2===h?(o=e(t.charAt(a))<<2|e(t.charAt(a+1))>>4,r(255&o)):1===h&&(o=e(t.charAt(a))<<10|e(t.charAt(a+1))<<4|e(t.charAt(a+2))>>2,r(o>>8&255),r(255&o)),u}function s(t){function e(t){return a.charAt(t)}function r(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}var s,n,i,o=t.length%3,h="";for(s=0,i=t.length-o;s<i;s+=3)n=(t[s]<<16)+(t[s+1]<<8)+t[s+2],h+=r(n);switch(o){case 1:n=t[t.length-1],h+=e(n>>2),h+=e(n<<4&63),h+="==";break;case 2:n=(t[t.length-2]<<8)+t[t.length-1],h+=e(n>>10),h+=e(n>>4&63),h+=e(n<<2&63),h+="="}return h}var n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="+".charCodeAt(0),o="/".charCodeAt(0),h="0".charCodeAt(0),u="a".charCodeAt(0),l="A".charCodeAt(0),f="-".charCodeAt(0),c="_".charCodeAt(0);t.toByteArray=r,t.fromByteArray=s}("undefined"==typeof r?this.base64js={}:r)},{}],13:[function(t,e,r){r.read=function(t,e,r,a,s){var n,i,o=8*s-a-1,h=(1<<o)-1,u=h>>1,l=-7,f=r?s-1:0,c=r?-1:1,p=t[e+f];for(f+=c,n=p&(1<<-l)-1,p>>=-l,l+=o;l>0;n=256*n+t[e+f],f+=c,l-=8);for(i=n&(1<<-l)-1,n>>=-l,l+=a;l>0;i=256*i+t[e+f],f+=c,l-=8);if(0===n)n=1-u;else{if(n===h)return i?NaN:(p?-1:1)*(1/0);i+=Math.pow(2,a),n-=u}return(p?-1:1)*i*Math.pow(2,n-a)},r.write=function(t,e,r,a,s,n){var i,o,h,u=8*n-s-1,l=(1<<u)-1,f=l>>1,c=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=a?0:n-1,d=a?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,i=l):(i=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-i))<1&&(i--,h*=2),e+=i+f>=1?c/h:c*Math.pow(2,1-f),e*h>=2&&(i++,h/=2),i+f>=l?(o=0,i=l):i+f>=1?(o=(e*h-1)*Math.pow(2,s),i+=f):(o=e*Math.pow(2,f-1)*Math.pow(2,s),i=0));s>=8;t[r+p]=255&o,p+=d,o/=256,s-=8);for(i=i<<s|o,u+=s;u>0;t[r+p]=255&i,p+=d,i/=256,u-=8);t[r+p-d]|=128*y}},{}],14:[function(t,e,r){var a=Array.isArray,s=Object.prototype.toString;e.exports=a||function(t){return!!t&&"[object Array]"==s.call(t)}},{}],"ndarray-fft":[function(t,e,r){"use strict";function a(t,e,r){var a,h,u=e.shape,l=u.length,f=1,c=new Array(l),p=0;for(a=l-1;a>=0;--a)if(c[a]=f,f*=u[a],p=Math.max(p,o.scratchMemory(u[a])),e.shape[a]!==r.shape[a])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var d,y=4*f+p;d="array"===e.dtype||"float64"===e.dtype||"custom"===e.dtype?i.mallocDouble(y):i.mallocFloat(y);var g,b,_,v,m=n(d,u.slice(0),c,0),w=n(d,u.slice(0),c.slice(0),f),S=n(d,u.slice(0),c.slice(0),2*f),A=n(d,u.slice(0),c.slice(0),3*f),P=4*f;for(s.assign(m,e),s.assign(w,r),a=l-1;a>=0&&(o(t,f/u[a],u[a],d,m.offset,w.offset,P),0!==a);--a){for(b=1,_=S.stride,v=A.stride,h=a-1;h<l;++h)v[h]=_[h]=b,b*=u[h];for(h=a-2;h>=0;--h)v[h]=_[h]=b,b*=u[h];s.assign(S,m),s.assign(A,w),g=m,m=S,S=g,g=w,w=A,A=g}s.assign(e,m),s.assign(r,w),i.free(d)}var s=t("ndarray-ops"),n=t("ndarray"),i=t("typedarray-pool"),o=t("./lib/fft-matrix.js");e.exports=a},{"./lib/fft-matrix.js":1,ndarray:"ndarray","ndarray-ops":3,"typedarray-pool":9}],ndarray:[function(t,e,r){(function(r){function a(t,e){return t[0]-e[0]}function s(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(a);var s=new Array(r.length);for(t=0;t<s.length;++t)s[t]=r[t][1];return s}function n(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var a="generic"===t;if(e===-1){var n="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}",i=new Function(n);return i()}if(0===e){var n="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",i=new Function("TrivialArray",n);return i(f[t][0])}var n=["'use strict'"],o=h(e),u=o.map(function(t){return"i"+t}),l="this.offset+"+o.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),c=o.map(function(t){return"b"+t}).join(","),p=o.map(function(t){return"c"+t}).join(",");n.push("function "+r+"(a,"+c+","+p+",d){this.data=a","this.shape=["+c+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),n.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+o.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),e<4?(n.push("function "+r+"_order(){"),2===e?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+r+"_set("+u.join(",")+",v){"),a?n.push("return this.data.set("+l+",v)}"):n.push("return this.data["+l+"]=v}"),n.push("proto.get=function "+r+"_get("+u.join(",")+"){"),a?n.push("return this.data.get("+l+")}"):n.push("return this.data["+l+"]}"),n.push("proto.index=function "+r+"_index(",u.join(),"){return "+l+"}"),n.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+o.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+o.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var d=o.map(function(t){return"a"+t+"=this.shape["+t+"]"}),y=o.map(function(t){return"c"+t+"=this.stride["+t+"]"});n.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+y.join(","));for(var g=0;g<e;++g)n.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");n.push("return new "+r+"(this.data,"+o.map(function(t){return"a"+t}).join(",")+","+o.map(function(t){return"c"+t}).join(",")+",b)}"),n.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+o.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+o.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var g=0;g<e;++g)n.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");n.push("return new "+r+"(this.data,"+o.map(function(t){return"a"+t}).join(",")+","+o.map(function(t){return"b"+t}).join(",")+",c)}");for(var b=new Array(e),_=new Array(e),g=0;g<e;++g)b[g]="a[i"+g+"]",_[g]="b[i"+g+"]";n.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+b.join(",")+","+_.join(",")+",this.offset)}"),n.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(var g=0;g<e;++g)n.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+o.map(function(t){return"shape["+t+"]"}).join(",")+","+o.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var i=new Function("CTOR_LIST","ORDER",n.join("\n"));return i(f[t],s)}function i(t){if(l&&r.isBuffer(t))return"buffer";if(u)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}function o(t,e,r,a){if(void 0===t){var s=f.array[0];return s([])}"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var o=e.length;if(void 0===r){r=new Array(o);for(var h=o-1,u=1;h>=0;--h)r[h]=u,u*=e[h]}if(void 0===a){a=0;for(var h=0;h<o;++h)r[h]<0&&(a-=(e[h]-1)*r[h])}for(var l=i(t),c=f[l];c.length<=o+1;)c.push(n(l,c.length-1));var s=c[o+1];return s(t,e,r,a)}var h=t("iota-array"),u="undefined"!=typeof Float64Array,l="undefined"!=typeof r,f={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};e.exports=o}).call(this,t("buffer").Buffer)},{buffer:11,"iota-array":10}]},{},[]);var ndarray=require("ndarray"),ndarray_fft=require("ndarray-fft"),STFT=new function(){var t=null,e=null,r=function(t,e){return 2/t*(t/2-Math.abs(e-(t-1)/2))},a=function(t,e){return.5*(1-Math.cos(2*Math.PI*e/(t-1)))},s=function(t,e){return.54-.46*Math.cos(2*Math.PI*e/(t-1))},n=function(t,e){return 2/(t-1)*((t-1)/2-Math.abs(e-(t-1)/2))},i=function(t,e){return.62-.48*Math.abs(e/(t-1)-.5)-.38*Math.cos(2*Math.PI*e/(t-1))},o=function(t,e,r){var a=(1-r)/2,s=.5,n=r/2;return a-s*Math.cos(DSP.TWO_PI*e/(t-1))+n*Math.cos(4*Math.PI*e/(t-1))},h=function(t,e){return Math.cos(Math.PI*e/(t-1)-Math.PI/2)},u=function(t,e,r){return Math.pow(Math.E,-.5*Math.pow((e-(t-1)/2)/(r*(t-1)/2),2))},l=function(t,e){var r=2*e/(t-1)-1;return Math.sin(Math.PI*r)/(Math.PI*r)},f=function(t,e){return 1},c=function(t,e){return 2*a(t,e)/3},p=function(t){return"hann"===t?a:"triangular"===t?r:"hamming"===t?s:"bartlett"===t?n:"bartlettHann"===t?i:"blackman"===t?o:"cosine"===t?h:"gauss"===t?u:"lanczos"===t?l:"rectangular"===t?f:a};this.initializeForwardWindow=function(e,r,a){t=new Float32Array(e),void 0===a&&(a=.16);var s=0,n=null;for(n="function"==typeof type?r:p(r),s=0;s<e;s+=1)t[s]=n(e,s,a)},this.initializeInverseWindow=function(t,r){e=new Float32Array(t);var a=0,s=c;for(a=0;a<t;a+=1)e[a]=s(a/(t-1))},this.forward=function(e,r,a){var a=a||e>>>2,s=new Float32Array(2*e),n=new Float32Array(e),i=new Float32Array(e),o=0,h=t,u=ndarray(n),l=ndarray(i);return function(t){var f,c,p,d=e,y=h,g=s,b=n,_=i;for(g.set(t,o),o+=d,c=0;c+d<=o;c+=a){for(f=0;f<d;++f)b[f]=g[f+c]*y[f];for(f=0;f<d;++f)_[f]=0;ndarray_fft(1,u,l),r(b,_)}for(p=o,f=0;c<p;++f,++c)g[f]=g[c];o=f}},this.inverse=function(t,r,a){var a=a||t>>>2,s=new Float32Array(2*t),n=s.subarray(0,t),i=0,o=0,h=e,u=ndarray(h),l=ndarray(h);return function(e,f){var c,p,d,y=t,g=h,b=s;for(u.data=e,l.data=f,ndarray_fft(-1,u,l),d=o,c=0,p=i;p<d;++c,++p)b[p]+=g[c]*e[c];for(;c<y;++c,++p)b[p]=g[c]*e[c];for(i+=a,o=p;i>=y;){for(r(n),c=0,p=y;c<y;++c,++p)b[c]=b[p];o-=y,i-=y}}}},_fs_palette={0:[0,0,0],10:[75,0,159],20:[104,0,251],30:[131,0,255],40:[155,18,157],50:[175,37,0],60:[191,59,0],70:[206,88,0],80:[223,132,0],90:[240,188,0],100:[255,252,0]},_spectrum_colors=[],_webMIDISupport=function(){return!!navigator.requestMIDIAccess},_isPowerOf2=function(t){return 0===(t&t-1)},_parseInt10=function(t){return parseInt(t,10)},_getElementOffset=function(t){var e=t.getBoundingClientRect(),r=document.body,a=document.documentElement,s=window.pageYOffset||a.scrollTop||r.scrollTop,n=window.pageXOffset||a.scrollLeft||r.scrollLeft,i=a.clientTop||r.clientTop||0,o=a.clientLeft||r.clientLeft||0,h=e.top+s-i,u=e.left+n-o;return{top:Math.round(h),left:Math.round(u),width:e.width,height:e.height}},_logScale=function(t,e,r){var a=r||2,s=Math.log(e+1)/Math.log(a),n=s*t/e;return Math.round(Math.pow(a,n)-1)},_melScale=function(){},_barkScale=function(t,e,r){var a=new Float32Array(t),s=0;for(s=0;s<a.length;s+=1)a[s]=s*e/r,a[s]=13*Math.atan(a[s]/1315.8)+3.5*Math.atan(Math.pow(a[s]/7518,2));return a},_getColorFromPalette=function(t){var e,r,a=100*t/255,s=10*Math.floor(a/10),n=a-s,i=n/10;return e=a<100?[_fs_palette[s+10][0]-_fs_palette[s+10][0],_fs_palette[s+10][1]-_fs_palette[s+10][1],_fs_palette[s+10][2]-_fs_palette[s+10][2]]:[0,0,0],r=[_fs_palette[s][0]+i*e[0],_fs_palette[s][1]+i*e[1],_fs_palette[s][2]+i*e[2]],"rgb("+r[0]+", "+r[1]+","+r[2]+")"},_truncateDecimals=function(t,e){var r=t.toString(),a=r.indexOf("."),s=a==-1?r.length:1+a+e,n=r.substr(0,s),i=isNaN(n)?0:n;return parseFloat(i)},_isFireFox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},_frequencyFromNoteNumber=function(t){return 440*Math.pow(2,(t-69)/12)},_getNoteTime=function(t,e){return 1/e*(60/t)},_lZeroPad=function(t,e,r){for(t=""+t;t.length<r;)t=e+t;return t},_setCookie=function(t,e,r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),document.cookie=t+"="+e+";expires="+a.toUTCString()+";path=/"},_getCookie=function(t){var e,r,a=0;for(t+="=",e=document.cookie.split(";"),a=0;a<e.length;a+=1){for(r=e[a];" "==r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return""},_toolsInit=function(){var t=0;for(t=0;t<256;t+=1)_spectrum_colors.push(_getColorFromPalette(t))};_toolsInit();var _progress=0,_stereo=!1,_convert=function(t,e){var r,a,s=t.note_time,n=Math.round(s*t.sample_rate),i=t.settings.window_length,o=t.settings.window_type,h=t.settings.overlap,u=Math.round(i/h),l=Math.round(i/2),f=e,c=Math.ceil(f.length/n),p=t.settings.height,d=(t.settings.height-1,t.settings.minfreq),y=t.settings.maxfreq,g=[],b=new Uint8ClampedArray(c*p*4),_=t.sample_rate/i,v=Math.round(d/_),m=Math.round(y/_),w=l+v,S=l+v+m,A=n/f.length*100,P=_parseInt10(c/8),I=0;for(n>2*i&&postMessage("Conversion failed, there is "+n+" samples to process for a window length (* 2) of "+2*i+", please use different settings."),_stereo&&(A/=2),STFT.initializeForwardWindow(i,o),r=STFT.forward(i,function(t,e){if(g.push({r:t,i:e}),g.length===h){var r,a,s,n,i,o,u=0,l=0,f=0,d=[],y=[];for(l=0;l<e.length;l+=1){for(r=0,a=0,f=0;f<h;f+=2)r+=g[f].i[l]+g[f+1].i[l],a+=g[f].r[l]+g[f+1].r[l];d[l]=a/h,y[l]=r/h}for(l=w;l<S;l+=1)s=v+_logScale(l-w,m),n=y[s],i=d[s],o=Math.round(Math.sqrt(i*i+n*n)/h*255),u=Math.round((l-w)/m*p)*c*4+I,b[u]=o,b[u+1]=o,b[u+2]=o,b[u+3]=255;I+=4,g=[]}},u),a=0;a<f.length;a+=n)_progress+=A,r(f.subarray(a,a+n)),a%P===0&&postMessage(_parseInt10(_progress,10));return{width:c,height:p,data:b}},_mergeChannels=function(t,e){var r=0;for(r=0;r<t.length;r+=4)t[r+1]=e[r+1],t[r+2]=(t[r]+e[r+1])/2,t[r+3]=255;return t};self.onmessage=function(t){"use strict";var e=t.data,r=new Float32Array(e.left),a=null,s=null,n=null,i={pbuffer:null,width:null,height:null};_progress=0,_stereo=null!==e.right,s=_convert(e,r),e.right?(a=new Float32Array(e.right),n=_convert(e,a),i.pbuffer=_mergeChannels(s.data,n.data).buffer):i.pbuffer=s.data.buffer,i.width=s.width,i.height=s.height,postMessage(i,[i.pbuffer])};